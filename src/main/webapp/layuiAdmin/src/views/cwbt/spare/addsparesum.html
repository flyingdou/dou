
<html>
<head>
<meta charset="utf-8">
	<title>新建备件</title>
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta name="apple-mobile-web-app-status-bar-style" content="black">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="format-detection" content="telephone=no">
</head>
<body  style="width:100%;height:100%">
 <div class="layui-card layadmin-header" style="background-color:#F2F2F2;">
  <div class="layui-breadcrumb" lay-filter="breadcrumb">
    <a lay-href="">首页</a>
    <a><cite>备件管理</cite></a>
    <a><cite>添加备件</cite></a>
  </div>
</div>


 <div class="layui-fluid">
    <div class="layui-row layui-col-space15">
      <div class="layui-col-md12">
        <div class="layui-card">
          <div class="layui-card-header">
          添加备件
			</div>
          <div class="layui-card-body">
							
							
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							  <legend>备件基本信息</legend>
					</fieldset>
				<form class="layui-form" action="" onsubmit="return false">
				<div style="margin-left: 10%;">
				
				
							<div class="layui-form-item">
							    <div class="layui-inline">
							      <label class="layui-form-label label-width" style="width: 90px;">备件编码</label>
							      <div class="layui-input-inline">
							        <input type="text" name="code" id="code"  autocomplete="off" class="layui-input"  disabled="disabled" placeholder = "编码自动生成无需输入">
							      </div>
							    </div>
							
							</div>
							
							<div class="layui-form-item">
							
						    <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">名称</label>
						      <div class="layui-input-inline">
						        <input type="text" name="name" class="layui-input" id="name" autocomplete="off" lay-verify="required">
						      </div>
						    </div>
						    <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">原编码</label>
						      <div class="layui-input-inline">
						        <input type="text" name="sourceCode" id="sourceCode"  autocomplete="off" class="layui-input">
						      </div>
						    </div>
						    <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">规格型号</label>
						      <div class="layui-input-inline">
						        <input type="text" name="model" id="model"  autocomplete="off" class="layui-input">
						      </div>
						    </div>
						  </div>
						  <div class="layui-form-item">
						    <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">厂家</label>
						      <div class="layui-input-inline">
						        <input type="text" name="manufactor" id="manufactor"  autocomplete="manufactor" class="layui-input" >
						      </div>
						    </div>
						   <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">所属部门</label>
						     <div class="layui-input-inline">
						    	<input type="text" id="department" name="department" lay-filter="tree" class="layui-input" lay-verify="required" >
						    </div>
						    </div>
						    <div class="layui-inline">
							      <label class="layui-form-label label-width" style="width: 90px;">仓库级别</label>
							      <div class="layui-input-inline">
							    	<select class="select"  name="level" id="level" lay-filter="level"   lay-verify="level">
							       
									</select>  
							      </div>
							    </div> 
						    
						   </div>
						 
						  <div class="layui-form-item" >
							  <div class="layui-inline">
							      <label class="layui-form-label label-width" style="width: 90px;">技术属性</label>
							      <div class="layui-input-inline">
							    	<select class="select"  name="skillAttribute" id="skillAttribute" lay-filter="skillAttribute"   lay-verify="skillAttribute">
							       
									</select>  
							      </div>
							    </div> 
							    <div class="layui-inline">
							      <label class="layui-form-label label-width" style="width: 90px;">特殊属性</label>
							      <div class="layui-input-inline">
							    	<select class="select"  name="specialAttribute" id="specialAttribute" lay-filter="specialAttribute"   lay-verify="specialAttribute">
							       
									</select>  
							      </div>
							    </div> 
							    <div class="layui-inline">
							      <label class="layui-form-label label-width" style="width: 90px;">专业属性</label>
							      <div class="layui-input-inline">
							    	<select class="select"  name="majorAttribute" id="majorAttribute" lay-filter="majorAttribute"   lay-verify="majorAttribute">
							       
									</select>  
							      </div>
							    </div>
						  </div>
						  <div class="layui-form-item" >
						  <div class="layui-inline">
						      <label class="layui-form-label label-width" style="width: 90px;">备注</label>
						      <div class="layui-input-inline">
						        <textarea  class="layui-textarea" name="remarks"  id="remarks" style="width:500px"></textarea>
						      </div>
						    </div>
						  </div>
						  
					</div>
					<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							  <legend>计量</legend>
					</fieldset>	
				<div style="margin-left: 10%;">
					<div class="layui-form-item" >
						<div class="layui-inline">
							<label class="layui-form-label label-width" style="width: 90px;">数量</label>
						      <div class="layui-input-inline">
						        <input type="text" name="number" id="number"  autocomplete="off" value="0" class="layui-input" lay-verify="require|double">
						      </div>
						</div>
						<div class="layui-inline">
							<label class="layui-form-label label-width" style="width: 90px;">单位</label>
						      <div class="layui-input-inline">
						        <select class="select"  name="unit" id="unit" lay-filter="unit"   lay-verify="unit">
							     </select> 
						      </div>
						</div>
					</div>
				</div>	
				
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
						<legend>预警设置</legend>
				</fieldset>	
				<div style="margin-left: 10%;">
					<div class="layui-form-item" >
						<div class="layui-inline">
							<label class="layui-form-label label-width" style="width: 90px;">预警数量</label>
						      <div class="layui-input-inline">
						        <input type="text" name="alertnumber" id="alertnumber"  autocomplete="off" value="0" class="layui-input" lay-verify="require|double">
						      </div>
						</div>
					</div>
				</div>	
				
				
				<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
							  
					</fieldset>		 
					<center>
					 <div class="layui-form-item" >
				    <div class="layui-inline">
				      <button class="layui-btn" lay-submit="" lay-filter="create">保存</button>
				    </div>
				  </div>
				  </center>
				</form>
			
			
		  </div>
		 </div>
		</div>
		</div>
		</div>

	
	<script>
	var table;
	var layer;
	var laytpl;
	var dataTable;
	var laydate;
	var form;
	var $;
	var loading;
	var treeSelect; 
	var json = [];
	layui.use(['table','form','layer','laydate','treeSelect'], function(){
	  table = layui.table,
	  layer = layui.layer,
	  loading = layer.load(1, {
    	  shade: [0.5,'#000'] //0.1透明度的白色背景
	    });
	  treeSelect= layui.treeSelect;
	  laydate = layui.laydate;
	  $ = layui.jquery;
		 $(document).ajaxStop(function (){
			 layer.close(loading);
			 
		 });
	 
	 form=layui.form,
	 
	 treeSelect.render({
         // 选择器
         elem: '#department',
         // 数据
         data: '/person/selectall',
         // 异步加载方式：get/post，默认get
         type: 'post',
         // 占位符
         placeholder: '请选择',
         // 是否开启搜索功能：true/false，默认false
         search: true,
         // 点击回调
         click: function(d){
             document.getElementById("department").value=d.current.id;
         },
         // 加载完成后的回调函数
         success: function (d) {
        	 select1();
         }
     });
	 
	 //保存
	 form.on('submit(create)', function(data){
		 loading = layer.load(1, {
   	  		shade: [0.5,'#000'] //0.1透明度的白色背景
	    });
			return saveData(data);
		});
	 
	
	 form.verify({
         
		    double: function(value){
		    if(/^\d+$/.test(value)==false && /^\d+\.\d+$/.test(value)==false)
		    {
		     return '您输入的不是数字';
		    }
		   }
		});
	 
	 
	});
	

	
	//提交
	function saveData(formData) {
			var result = false;
				$.ajax({
					url: "/wcSparesum/addoreditspare",
					async: false,
					dataType: "json",
					type: "post",
					data: formData.field,
					success: function(data) {
						finalily();
					}
				});
			return result;
		}
	//跳转页面
	function  finalily(){
		window.location.href="#/cwbt/spare/listsparesum"; 
	}
	
	 //下拉框(维修级别)（定期）
	  function select1() {
		  $("select[name=level]").empty();
		  $("select[name=skillAttribute]").empty();
		  $("select[name=specialAttribute]").empty();
		  $("select[name=majorAttribute]").empty();
		  $("select[name=unit]").empty();
		   $.ajax({
		    async: false,
		    type: "POST",
		    url: "/wcSparesum/showselect",
		    dataType: "json",
		    data: {},
		    success: function (res) {
		  for(var i=0; i<res.wcSparelevellist.length; i++){
			  if(res.wcSparelevellist[i].id!=null && res.wcSparelevellist[i].id!=''){
				  var option="<option value=\""+res.wcSparelevellist[i].id+"\"";
				  option += ">"+res.wcSparelevellist[i].name+"</option>"; //动态添加数据
				  $("select[name=level]").append(option);
			  }
		  }
		  for(var i=0; i<res.wcSpareskilllist.length; i++){
			  if(res.wcSpareskilllist[i].id!=null && res.wcSpareskilllist[i].id!=''){
				  var option="<option value=\""+res.wcSpareskilllist[i].id+"\"";
				  option += ">"+res.wcSpareskilllist[i].name+"</option>"; //动态添加数据
				  $("select[name=skillAttribute]").append(option);
			  }
		  }
		  for(var i=0; i<res.WcSparespeciallist.length; i++){
			  if(res.WcSparespeciallist[i].id!=null && res.WcSparespeciallist[i].id!='' ){
				  var option="<option value=\""+res.WcSparespeciallist[i].id+"\"";
				  option += ">"+res.WcSparespeciallist[i].name+"</option>"; //动态添加数据
				  $("select[name=specialAttribute]").append(option);
			  }
		  }
		  for(var i=0; i<res.WcSparemajorlist.length; i++){
			  if(res.WcSparemajorlist[i].id!=null && res.WcSparemajorlist[i].id!='' ){
				  var option="<option value=\""+res.WcSparemajorlist[i].id+"\"";
				  option += ">"+res.WcSparemajorlist[i].name+"</option>"; //动态添加数据
				  $("select[name=majorAttribute]").append(option);
			  }
		  }
		  for(var i=0; i<res.wcUnitlist.length; i++){
			  if(res.wcUnitlist[i].id!=null && res.wcUnitlist[i].id!='' ){
				  var option="<option value=\""+res.wcUnitlist[i].id+"\"";
				  option += ">"+res.wcUnitlist[i].name+"</option>"; //动态添加数据
				  $("select[name=unit]").append(option);
			  }
		  } 
		  form.render('select'); 
		    }
		   });
		  }
	 
	  
	
		
		 /**************************************时间格式化处理************************************/
		 function dateFtt(fmt,date)   
		 { //author: meizz   
		   var o = {   
		     "M+" : date.getMonth()+1,                 //月份   
		     "d+" : date.getDate(),                    //日   
		     "h+" : date.getHours(),                   //小时   
		     "m+" : date.getMinutes(),                 //分   
		     "s+" : date.getSeconds(),                 //秒   
		     "q+" : Math.floor((date.getMonth()+3)/3), //季度   
		     "S"  : date.getMilliseconds()             //毫秒   
		   };   
		   if(/(y+)/.test(fmt))   
		     fmt=fmt.replace(RegExp.$1, (date.getFullYear()+"").substr(4 - RegExp.$1.length));   
		   for(var k in o)   
		     if(new RegExp("("+ k +")").test(fmt))   
		   fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));   
		   return fmt;   
		 }
		 
		</script>
	
<style>
	.layui-layer-title{background: #fff;border: 1px solid #e5e5e5;border-top-left-radius: 4px;border-top-right-radius: 4px;font-size: 18px;}
</style>

</body>
</html>