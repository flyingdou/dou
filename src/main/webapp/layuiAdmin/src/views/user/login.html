<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>Insert title here</title>
</head>
<body>
<script type="text/html" template>
  <link rel="stylesheet" href="{{ layui.setter.base }}style/login.css?v={{ layui.admin.v }}-1" media="all">
</script>
<script type="text/javascript" src = "../../../../../vue/vue.min.js"></script>
<script type="text/javascript" src = "../../../../../jquery-3.3.1/jquery-3.3.1/jquery-3.3.1.min.js"></script>
<div class="layadmin-user-login layadmin-user-display-show" id="LAY-user-login" >

  <div class="layadmin-user-login-main">
    <div class="layadmin-user-login-box layadmin-user-login-header">
    <img  src="/layuiAdmin/start/layui/images/logo.jpg">
      <h2>数字机务</h2>
      <p>长江武汉航道局</p>
    </div>
    <div class="layadmin-user-login-box layadmin-user-login-body layui-form">
      <div class="layui-form-item">
        <label class="layadmin-user-login-icon layui-icon layui-icon-username" for="LAY-user-login-username"></label>
        <input type="text" name="account" v-model="user.account" id="LAY-user-login-username" lay-verify="required" placeholder="用户名" class="layui-input">
      </div>
      <div class="layui-form-item">
        <label class="layadmin-user-login-icon layui-icon layui-icon-password" for="LAY-user-login-password"></label>
        <input type="password" name="password" v-model="user.password" id="LAY-user-login-password" lay-verify="required" placeholder="密码" class="layui-input">
      </div>
      <!-- <div class="layui-form-item" style="margin-bottom: 20px;"> -->
        <!-- <input type="checkbox" name="remember" lay-skin="primary" title="记住密码"> -->
       <!--  <a lay-href="/user/forget" class="layadmin-user-jump-change layadmin-link" style="margin-top: 7px;">忘记密码？</a>
      </div> -->
      <div class="layui-form-item">
        <button class="layui-btn layui-btn-fluid" lay-submit lay-filter="LAY-user-login-submit" @click="login()" id="btn1">登 入</button>
      </div>
      <!-- <div class="layui-trans layui-form-item layadmin-user-login-other">
        <label>社交账号登入</label>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-qq"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-wechat"></i></a>
        <a href="javascript:;"><i class="layui-icon layui-icon-login-weibo"></i></a>
       
        <a lay-href="/user/reg" class="layadmin-user-jump-change layadmin-link">注册帐号</a>
      </div> -->
    </div>
  </div>
  
  <div class="layui-trans layadmin-user-login-footer">
    
    <p>© 2019 <a href="http://www.zcwish.com/" target="_blank">zcwish.com</a></p>
    <p>
      <span><a href="http://www.cjhdj.com.cn/zzq/whhdj/" target="_blank">长江武汉航道局</a></span>
      <span><a href="http://www.zcwish.com" target="_blank">武汉至诚无限</a></span>
    </p>
  </div>
  
  <!--<div class="ladmin-user-login-theme">
    <script type="text/html" template>
      <ul>
        <li data-theme=""><img src="{{ layui.setter.base }}style/res/bg-none.jpg"></li>
        <li data-theme="#03152A" style="background-color: #03152A;"></li>
        <li data-theme="#2E241B" style="background-color: #2E241B;"></li>
        <li data-theme="#50314F" style="background-color: #50314F;"></li>
        <li data-theme="#344058" style="background-color: #344058;"></li>
        <li data-theme="#20222A" style="background-color: #20222A;"></li>
      </ul>
    </script>
  </div>-->
  
</div>

<script>
var hq = new Vue({
	 el: "#LAY-user-login",
	 data: {
			user: {}
		},
	 mounted: function () {
		 setTimeout(this.init, 100);
	 },
	 methods: {
		 login: function(){
			 $("#btn1").attr("disabled",true); 
			 layui.use(['admin', 'form', 'user'], function(){
				  var $ = layui.$
				  ,setter = layui.setter
				  ,admin = layui.admin
				  ,form = layui.form
				  ,router = layui.router()
				  ,search = router.search;
				  form.render();
				  layer.open({
   					  id:"yanz",
   				      type: 2,
   				      title: '安全验证',
   				      maxmin: true,
   				      shadeClose: true, //点击遮罩关闭层
   				      area : ['400px' , '300px'],
   				      content: '/layuiAdmin/src/views/user/huak.html'
   				    });
				  
			 });
			 $("#btn1").attr("disabled",false); 
		 }
	 }
});

 
/* 
 layui.use(['admin', 'form', 'user'], function(){
  var $ = layui.$
  ,setter = layui.setter
  ,admin = layui.admin
  ,form = layui.form
  ,router = layui.router()
  ,search = router.search;

  form.render();

  //提交
  form.on('submit(LAY-user-login-submit)', function(obj){
  console.log(obj.field);
    //请求登入接口
    admin.req({
      url: '/user/login' //实际使用请改成服务端真实接口
      ,data:{"account":obj.field.account,"password":obj.field.password}
      ,done: function(res){
        //请求成功后，写入 access_token
        layui.data(setter.tableName, {
          key: setter.request.tokenName
          ,value: res.data
        });
        
        //登入成功的提示与跳转
        layer.msg('登入成功', {
          offset: '15px'
          ,icon: 1
          ,time: 1000
        }, function(){
          location.hash = search.redirect ? decodeURIComponent(search.redirect) : '/';
        });
      }
    });
    
  });
  
   
  
  
});*/ 
function logins(){
	 layui.use(['admin', 'form', 'user'], function(){
		 
		  var $ = layui.$
		  ,setter = layui.setter
		  ,admin = layui.admin
		  ,form = layui.form
		  ,router = layui.router()
		  ,search = router.search,
		  loading = layer.load(1, {
	    	  shade: [0.5,'#000'] //0.1透明度的白色背景
		    });
			  $.ajax({
		  		url:"/user/login",
		  		dataType:'json',
		  		type:'POST',
		  		data:{"account":hq.user.account,"password":hq.user.password},
		  		success:function(res){
		  			//登入成功的提示与跳转
		  			if(res.code=='0'){
		  				
		  				//请求成功后，写入 access_token
		  		        layui.data(setter.tableName, {
		  		          key: setter.request.tokenName
		  		          ,value: res.data
		  		        });
		  		      layui.data(setter.tableName, {
		  		          key: setter.request.user
		  		          ,value: res.msg
		  		        });
		  		    	layer.close(loading);
		  		  /*     sessionStorage.setItem("USER",res.msg); */
		      	        layer.msg('登入成功', {
		      	          offset: '15px'
		      	          ,icon: 1
		      	          ,time: 1000
		      	        }, function(){
		      	        	window.parent.location.href="/index.html";
		      	        	
		      	        });
		  		    }else{

		  		    	layer.close(loading);
		  		    	layer.msg('账号后密码错误或用户已被禁用！');
		  		    	layui.data(setter.tableName, {
		      		          key: setter.request.tokenName
		      		          ,value: res.data
		      		        });
		  		    }
		  		}
		  	});
	 });
}
</script>
</body>
</html>